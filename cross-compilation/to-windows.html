<!DOCTYPE html>
<!-- Page last generated 2019-03-06 13:48:16 +0000 -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cross compilation: to Windows</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Rust, Rust programming language, rustlang, rust-lang, Mozilla Rust">
    <meta name="description" content="A systems programming language that runs blazingly fast, prevents segfaults, and guarantees thread safety.">
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/forge.css">
    <link rel="stylesheet" href="/rust-forge/css/bootstrap.css">
    <link rel="stylesheet" href="/rust-forge/css/style.css">
    <link rel="stylesheet" href="/rust-forge/css/forge.css">
  </head>

  <body class="container">

    <header>

    <ul class="row menu">
      <li class="col-xs-12 col-md-2">
        <a href="index.html">
	  <!-- FIXME: absolute urls -->
          <img class="img-responsive" src="https://www.rust-lang.org/logos/rust-logo-blk.svg" onerror="this.src='https://www.rust-lang.org/logos/rust-logo-256x256-blk.png'" height="128" width="128" alt="Rust logo" />
        </a>
      </li>
      <li class="col-xs-12 col-md-6 menu">
	<h1>Rust Forge</h1>
      </li>
    </ul>
    </header>

    <div class="content"><h1 id="cross-compilation-to-windows">Cross compilation: to Windows</h1>

<ol>
  <li>Acquire LLD somehow. Either your distro provides it or you have to build it from source.</li>
  <li>You’ll need an lld-link wrapper, which is just lld using the link flavor so it accepts the same flags as link.exe. You may either have a binary called lld-link, or you may have to write some sort of script to wrap lld.</li>
  <li>If you want to be able to cross compile C/C++ as well, you will need to obtain clang-cl, which is clang pretending to be cl.</li>
  <li>You’ll need libraries from an existing msvc installation on Windows to link your Rust code against. You’ll need the VC++ libraries from either VS 2015 or VS 2017, and the system libraries from either the Windows 8.1 or Windows 10 SDK. Here are some approximate paths which may vary depending on the exact version you have installed. Copy them over to your non-windows machine.
    <ul>
      <li>VS 2015: C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\lib</li>
      <li>VS 2017: C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Tools\MSVC\14.10.24728\lib</li>
      <li>Windows 10 SDK: C:\Program Files (x86)\Windows Kits\10\Lib\10.0.14393.0</li>
      <li>Windows 8.1 SDK: C:\Program Files (x86)\Windows Kits\8.1\Lib\winv6.3</li>
    </ul>
  </li>
  <li>If you want to cross compile C/C++ you’ll also need headers. Replace <code class="highlighter-rouge">lib</code> in the above paths with <code class="highlighter-rouge">include</code> to get the appropriate headers.</li>
  <li>Set your LIB and INCLUDE environment variables to semicolon separated lists of all the relevant directories for the correct architecture.</li>
  <li>In your .cargo/config add <code class="highlighter-rouge">[target.x86_64-pc-windows-msvc] linker = "lld-link"</code> or whatever your lld pretending to be link.exe is called.</li>
  <li>For cross compiling C/C++, you’ll need to get the gcc crate working correctly. I never tested it to cross compile, I have no idea whether it will even do anything sane.</li>
  <li>Install the appropriate target using rustup and pass <code class="highlighter-rouge">--target=x86_64-pc-windows-msvc</code> while building. Hopefully it works. If it doesn’t, well… I don’t know.</li>
</ol>
</div>

  </body>
</html>
