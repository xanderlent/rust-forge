<!DOCTYPE html>
<!-- Page last generated 2019-03-06 13:48:16 +0000 -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>The Rust Release Process &middot; The Rust Programming Language</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Rust, Rust programming language, rustlang, rust-lang, Mozilla Rust">
    <meta name="description" content="A systems programming language that runs blazingly fast, prevents segfaults, and guarantees thread safety.">
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/forge.css">
    <link rel="stylesheet" href="/rust-forge/css/bootstrap.css">
    <link rel="stylesheet" href="/rust-forge/css/style.css">
    <link rel="stylesheet" href="/rust-forge/css/forge.css">
  </head>

  <body class="container">

    <header>

    <ul class="row menu">
      <li class="col-xs-12 col-md-2">
        <a href="index.html">
	  <!-- FIXME: absolute urls -->
          <img class="img-responsive" src="https://www.rust-lang.org/logos/rust-logo-blk.svg" onerror="this.src='https://www.rust-lang.org/logos/rust-logo-256x256-blk.png'" height="128" width="128" alt="Rust logo" />
        </a>
      </li>
      <li class="col-xs-12 col-md-6 menu">
	<h1>Rust Forge</h1>
      </li>
    </ul>
    </header>

    <div class="content"><h1 id="the-rust-release-process">The Rust Release Process</h1>

<p>Here’s how Rust is currently released:</p>

<h2 id="update-books-t-6-days-friday">Update books (T-6 days, Friday)</h2>

<p>From within the repo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>src/doc/book
<span class="nv">$ </span>git fetch origin
<span class="nv">$ </span>git reset <span class="nt">--hard</span> origin/master
<span class="nv">$ </span><span class="nb">cd</span> ../rust-by-example
<span class="nv">$ </span>git fetch origin
<span class="nv">$ </span>git reset <span class="nt">--hard</span> origin/master
<span class="nv">$ </span><span class="nb">cd</span> ../reference
<span class="nv">$ </span>git fetch origin
<span class="nv">$ </span>git reset <span class="nt">--hard</span> origin/master
<span class="nv">$ </span><span class="nb">cd</span> ../nomicon
<span class="nv">$ </span>git fetch origin
<span class="nv">$ </span>git reset <span class="nt">--hard</span> origin/master
<span class="nv">$ </span><span class="nb">cd</span> ../../..
<span class="nv">$ </span>git add <span class="nb">.</span>
<span class="nv">$ </span>git commit <span class="nt">-m</span> <span class="s2">"update books for next release"</span>
</code></pre></div></div>

<p>This can be done a day earlier too, if you’d like: the books are only tested fully once they’re in
this repo, and so updating them may cause tests to fail. If they do, you need to send in a PR to
the right book, ping @steveklabnik to get a quick merge, and then update that particular book again
to fix it. This should be relatively rare.</p>

<h2 id="promote-beta-to-stable-t-3-days-monday">Promote beta to stable (T-3 days, Monday)</h2>

<p>Promote beta to stable. Temporarily turn off GitHub branch protection for the
<code class="highlighter-rouge">stable</code> branch in rust-lang/rust repo. In your local Rust repo:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git fetch rust-lang
<span class="nv">$ </span>git push rust-lang rust-lang/beta:stable <span class="nt">-f</span>
</code></pre></div></div>

<p>Re-enable branch protection for the <code class="highlighter-rouge">stable</code> branch. Send a PR to
rust-lang/rust on the stable branch making the following changes:</p>

<ul>
  <li>Update the cargo submodule to the latest of the branch for this rustc version.
Cargo branches are named <code class="highlighter-rouge">rust-1.17.0</code> and such.</li>
  <li>Update the rls submodule to the latest of the branch for this rustc version
as with Cargo, only if the RLS has such a branch (currently it doesn’t).</li>
  <li>Update <code class="highlighter-rouge">src/ci/run.sh</code> to pass <code class="highlighter-rouge">channel=stable</code>, not <code class="highlighter-rouge">channel=beta</code>.</li>
</ul>

<p>Once the PR is sent, r+ it and give it a high <code class="highlighter-rouge">p=1000</code>.</p>

<p>The stable build will <strong>not</strong> deploy automatically to prod. The
rust-central-station repository is configured to upload to <strong>dev</strong> every hour if
it detects a change. You should be able to browse changes in dev.</p>

<p>As soon as this build is done post a message to irlo asking for testing. The
index is
https://dev-static-rust-lang-org.s3.amazonaws.com/dist/2015-09-17/index.html and
our URL is then https://dev-static.rust-lang.org/dist/2015-09-17/index.html.</p>

<p>Test rustup with</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">RUSTUP_DIST_SERVER</span><span class="o">=</span>https://dev-static.rust-lang.org rustup update stable
</code></pre></div></div>

<h2 id="promote-master-to-beta-t-2-days-tuesday">Promote master to beta (T-2 days, Tuesday)</h2>

<p>Branch a rust-lang/cargo commit for the new beta:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>cargo
<span class="nv">$ </span>git fetch rust-lang
<span class="nv">$ </span>git push rust-lang rust-lang/master:rust-1.14.0
</code></pre></div></div>

<p>In theory one day we’ll do the same for rust-lang/rls, but for now we
haven’t done this yet.</p>

<p>Temporarily disable banch protection on GitHub for the <code class="highlighter-rouge">beta</code> branch of the Rust
repo. Promote rust-lang/rust’s master branch to beta as with yesterday:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git fetch rust-lang
<span class="nv">$ </span>git push rust-lang rust-lang/master:beta <span class="nt">-f</span>
</code></pre></div></div>

<p>Re-enable branch protection on GitHub. Send a PR to the freshly created beta
branch of rust-lang/rust which:</p>

<ul>
  <li>Update src/stage0.txt
    <ul>
      <li>Change <code class="highlighter-rouge">date</code> to “YYYY-MM-DD” where the date is the archive date the stable
build was uploaded</li>
      <li>Change <code class="highlighter-rouge">rustc</code> to “X.Y.Z” where that’s the version of rustc you just build</li>
      <li>Change <code class="highlighter-rouge">cargo</code> to “A.B.C” where it’s Cargo’s version. That’s typically
“0.(Y+1).0” wrt the rustc version.</li>
      <li>Uncomment <code class="highlighter-rouge">dev: 1</code></li>
    </ul>
  </li>
  <li>Update src/ci/run.sh to pass “–release-channel=beta”.</li>
  <li>Update the cargo submodule to the head of the versioned branch</li>
</ul>

<p>Note that you probably don’t want to update the RLS if it’s working, but if it’s
not working beta won’t land and it’ll need to get updated. After this PR merges
(through @bors) the beta should be automatically released.</p>

<h1 id="master-bootstrap-update-t-1-day-wednesday">Master bootstrap update (T-1 day, Wednesday)</h1>

<p>Write a new blog post, update rust-www, and update rust-forge. Submit PRs for
tomorrow.</p>

<p>Send a PR to the master branch to:</p>

<ul>
  <li>modify src/stage0.txt to bootstrap from yesterday’s beta</li>
  <li>modify src/bootstrap/channel.rs with the new version number</li>
  <li>Update the cargo submodule to the master branch</li>
</ul>

<p>In theory update the RLS submodule as well, but it’s pretty susceptible to
breakage so I’d probably avoid that for now.</p>

<h2 id="release-day-thursday">Release day (Thursday)</h2>

<p>Decide on a time to do the release, T.</p>

<ul>
  <li>
    <p><strong>T-30m</strong> - This is on rust-central-station:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker exec -d -it rcs bash -c 'promote-release /tmp/stable stable /data/secrets.toml 2&gt;&amp;1 | logger --tag release-stable-realz'
</code></pre></div>    </div>

    <p>That’ll, in the background, schedule the <code class="highlighter-rouge">promote-release</code> binary to run on the
production secrets (not the dev secrets). That’ll sign everything, upload it,
update the html index pages, and invalidate the CDN. Note that this takes about
30 minutes right now. Logs are in <code class="highlighter-rouge">/opt/rcs/logs</code>.</p>
  </li>
  <li>
    <p><strong>T-10m</strong> - Locally, tag the new release and upload it. Use “x.y.z release” as
the commit message.</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git tag <span class="nt">-u</span> FA1BE5FE 1.3.0 <span class="nv">$COMMIT_SHA</span>
<span class="nv">$ </span>git push rust-lang 1.3.0
</code></pre></div>    </div>
    <p>After this <a href="https://github.com/rust-lang-nursery/thanks#thanks">Update thanks.rust-lang.org</a>.</p>
  </li>
  <li>
    <p><strong>T-5m</strong> - Merge blog post.</p>
  </li>
  <li><strong>T</strong> - Tweet and post everything!
    <ul>
      <li>Twitter <a href="https://twitter.com/rustlang">@rustlang</a></li>
      <li>Reddit <a href="https://www.reddit.com/r/rust/">/r/rust</a></li>
      <li><a href="https://news.ycombinator.com/">Hacker News</a></li>
      <li><a href="https://users.rust-lang.org/">Users forum</a></li>
    </ul>
  </li>
  <li>
    <p><strong>T+5m</strong> - Tag Cargo the same way as rust-lang/rust and then run <code class="highlighter-rouge">cargo
publish</code> for the tag you just created.</p>

    <p>Also tag RLS the same way and then run <code class="highlighter-rouge">cargo publish</code> for the tag you just
created.</p>
  </li>
  <li><strong>T+1hr</strong> Send a PR to the beta branch to comment out <code class="highlighter-rouge">dev: 1</code> again and
update the date to download from (modifying <code class="highlighter-rouge">src/stage0.txt</code>).</li>
</ul>

<p>Bask in your success.</p>

<h1 id="update-dependencies-t1-day-friday">Update dependencies (T+1 day, Friday)</h1>

<p>In the repo:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>src
<span class="nv">$ </span>cargo update
</code></pre></div></div>

<p>The very ambitious can use https://crates.io/crates/cargo-outdated and update through breaking changes.</p>
</div>

  </body>
</html>
